---
import Container from "@/src/components/Container.astro"
// import DecorativeText from "@/src/components/DecorativeText.astro"
// import HeadingText from "@/src/components/HeadingText.astro"
import Layout from "@/src/layouts/Layout.astro"

import leafIcon from "@/src/assets/leaf-1.svg?raw"
import leafIcon2 from "@/src/assets/leaf-2.svg?raw"
import { getOfferGroup, getOfferGroupsSlugs } from "@/src/data"
import { PortableText } from "astro-portabletext"

export async function getStaticPaths() {
  async function obtainOfferGroupsSlugs() {
    const slugs = await getOfferGroupsSlugs()

    type Slug = {
      slug: {
        current: string
      }
    }

    return slugs.map((slug: Slug) => {
      return {
        params: {
          slug: slug.slug.current,
        },
      }
    })
  }

  const slugs = await obtainOfferGroupsSlugs()

  return [...slugs]
}

const currentSlug = Astro.params.slug
const offerGroup = await getOfferGroup(currentSlug)
---

<Layout title={offerGroup.title} description={offerGroup.description}>
  <section class:list={["relative"]}>
    <Container>
      <!-- <div class:list={["h-[80vh]", "max-h-[750px]", "flex", "items-center"]}>
        <div class:list={["lg:w-4/5", "-mt-32"]}>
          <HeadingText as="h1" text={offerGroup.title} />
          <DecorativeText text={offerGroup.description} />
        </div>
      </div> -->
      {
        offerGroup.services.map((service) => {
          return (
            <>
              <h2>{service.name}</h2>
              <PortableText value={service.description} />
            </>
          )
        })
      }
      <div class="accordion accordion--radio">
        {
          offerGroup.services.map((service, index: number) => {
            return (
              <>
                <div class="tab">
                  <input type="radio" name="accordion-2" id={`rd${index}`} />
                  <label for={`rd${index}`} class="tab__label">
                    <h2>{service.name}</h2>
                  </label>
                  <div class="tab__content">
                    <PortableText value={service.description} />
                  </div>
                </div>
              </>
            )
          })
        }
        <!-- TODO: uncomment if you need it -->
        <div class="tab">
          <input type="radio" name="accordion-2" id="rdClose" />
          <label for="rdClose" class="tab__close">Close open tab &times;</label>
        </div>
      </div>
    </Container>
    <div class:list={["absolute", "top-0", "w-full", "h-full", "-z-10"]}>
      <div
        class:list={["absolute", "-left-52", "lg:left-[unset]", "lg:right-72"]}
        set:html={leafIcon}
      />
      <div
        class:list={["hidden", "lg:block", "absolute", "-right-60"]}
        set:html={leafIcon2}
      />
    </div>
  </section>
</Layout>

<style>
  :root {
    --primary: #227093;
    --secondary: #ff5252;
    --background: #eee;
    --highlight: #ffda79;
    /* Theme color */
    --theme: var(--primary);
  }
  *,
  *::before,
  *::after {
    box-sizing: border-box;
  }

  /* Core styles/functionality */
  .tab input {
    position: absolute;
    opacity: 0;
    z-index: -1;
  }
  .tab__content {
    max-height: 0;
    overflow: hidden;
    transition: all 0.35s;
  }
  .tab input:checked ~ .tab__content {
    max-height: 10rem;
  }

  /* Visual styles */
  .accordion {
    color: var(--theme);
    border: 2px solid;
    border-radius: 0.5rem;
    overflow: hidden;
  }
  .tab__label,
  .tab__close {
    display: flex;
    color: white;
    background: var(--theme);
    cursor: pointer;
  }
  .tab__label {
    justify-content: space-between;
    padding: 1rem;
  }
  .tab__label::after {
    content: "\276F";
    width: 1em;
    height: 1em;
    text-align: center;
    transform: rotate(90deg);
    transition: all 0.35s;
  }
  .tab input:checked + .tab__label::after {
    transform: rotate(270deg);
  }
  .tab__content p {
    margin: 0;
    padding: 1rem;
  }
  .tab__close {
    justify-content: flex-end;
    padding: 0.5rem 1rem;
    font-size: 0.75rem;
  }
  .accordion--radio {
    --theme: var(--secondary);
  }

  /* Arrow animation */
  .tab input:not(:checked) + .tab__label:hover::after {
    animation: bounce 0.5s infinite;
  }
  @keyframes bounce {
    25% {
      transform: rotate(90deg) translate(0.25rem);
    }
    75% {
      transform: rotate(90deg) translate(-0.25rem);
    }
  }
</style>
