---
import { getPriceList } from "@/src/data"

import { PortableText } from "astro-portabletext"

import Container from "@/src/components/Container.astro"
import DecoLeafs from "@/src/components/DecoLeafs.astro"
import DecorativeText from "@/src/components/DecorativeText.astro"
import HeadingText from "@/src/components/HeadingText.astro"
import Breadcrumbs from "@/src/components/Breadcrumbs.astro"
import Layout from "@/src/layouts/Layout.astro"

const path = Astro.url.pathname
const { sectionHero, priceList } = await getPriceList()
const { headline, tagline } = sectionHero
---

<Layout title="Cennik" description="">
  <section class="relative">
    <DecoLeafs />
    <Container>
      <Breadcrumbs path={path} />
      <div class:list={["mx-auto", "md:w-3/4", "mt-16"]}>
        <div class="mb-20">
          {headline && <HeadingText as="h1" text={headline} />}
          {tagline && <DecorativeText text={tagline} />}
        </div>
        <div>
          {
            Array.isArray(priceList) &&
              priceList.map((item) => {
                const { name, variants } = item
                return (
                  <div class="mb-8">
                    <h2 class:list={["text-2xl", "font-bold", "mb-4"]}>
                      {name}
                    </h2>
                    <div>
                      {Array.isArray(variants) &&
                        variants.map((variant) => {
                          return (
                            <div
                              class:list={["flex", "justify-between", "mb-4"]}
                            >
                              <div class:list={["variant-name"]}>
                                {typeof variant.name === "string" ? (
                                  <h2>{variant.name}</h2>
                                ) : (
                                  <PortableText value={variant.name} />
                                )}
                              </div>
                              <p>{variant.price}</p>
                            </div>
                          )
                        })}
                    </div>
                  </div>
                )
              })
          }
        </div>
      </div>
    </Container>
  </section>
</Layout>

<style>
  .variant-name {
    max-width: 75%;
    margin-right: 0.5em;

    @media (min-width: 768px) {
      max-width: 50%;
    }
  }

  p {
    display: flex;
    flex-grow: 1;
    align-self: end;
    font-size: var(--scale-great-primer);
    line-height: 0.95em;
    gap: 0.5em;

    &::before {
      content: "";
      flex-grow: 1;
      border-bottom: 1px dotted rgba(0, 0, 0, 0.2);
    }
  }
</style>
